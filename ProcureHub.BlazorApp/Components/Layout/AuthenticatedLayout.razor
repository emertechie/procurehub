@inherits LayoutComponentBase

<RadzenComponents @rendermode="InteractiveServer" />

<RadzenLayout>
    <RadzenHeader>
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="1rem" Class="rz-p-4">
            <RadzenSidebarToggle Click="@(() => sidebarExpanded = !sidebarExpanded)" />
            <RadzenBreadCrumb>
                <RadzenBreadCrumbItem Path="/dashboard" Text="Home" />
            </RadzenBreadCrumb>
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem"
                Style="margin-left: auto;">
                <AuthorizeView>
                    <Authorized>
                        <RadzenProfileMenu>
                            <Template>
                                <RadzenGravatar Email="@context.User.Identity?.Name" />
                            </Template>
                            <ChildContent>
                                <RadzenProfileMenuItem Text="Profile" Path="/Account/Manage" />
                                <li class="rz-navigation-item" style="list-style: none;">
                                    <form action="Account/Logout" method="post" style="margin: 0;">
                                        <AntiforgeryToken />
                                        <input type="hidden" name="ReturnUrl" value="@GetReturnUrl()" />
                                        <button type="submit" class="rz-navigation-item-link"
                                            style="width: 100%; text-align: left; border: none; background: none; cursor: pointer; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <span>Logout</span>
                                        </button>
                                    </form>
                                </li>
                            </ChildContent>
                        </RadzenProfileMenu>
                    </Authorized>
                </AuthorizeView>
            </RadzenStack>
        </RadzenStack>
    </RadzenHeader>

    <RadzenSidebar @bind-Expanded="@sidebarExpanded" style="width: 250px">
        <RadzenStack Gap="1rem" Class="rz-p-4">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                <div style="display: flex; align-items: center; justify-content: center; width: 2rem; height: 2rem; background-color: var(--rz-primary); border-radius: 0.375rem;">
                    <RadzenIcon Icon="inventory_2" Style="font-size: 1rem; color: white;" />
                </div>
                <RadzenStack Gap="0">
                    <RadzenText TextStyle="TextStyle.Subtitle1" Style="margin: 0; font-weight: 600; color: var(--rz-text-contrast-color);">ProcureHub
                    </RadzenText>
                    <RadzenText TextStyle="TextStyle.Caption" Style="margin: 0; color: var(--rz-base-200);">Procurement System</RadzenText>
                </RadzenStack>
            </RadzenStack>
        </RadzenStack>

        <RadzenPanelMenu>
            <RadzenPanelMenuItem Text="Overview" Icon="dashboard">
                <RadzenPanelMenuItem Text="Home" Path="/dashboard" Icon="home" />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Request Management" Icon="description">
                <RadzenPanelMenuItem Text="Requests" Path="/requests" Icon="list_alt" />
                <AuthorizeView Roles="Requester">
                    <RadzenPanelMenuItem Text="New Request" Path="/requests/new" Icon="add_circle" />
                </AuthorizeView>
            </RadzenPanelMenuItem>

            <AuthorizeView Roles="Approver">
                <RadzenPanelMenuItem Text="Approvals" Icon="check_circle">
                    <RadzenPanelMenuItem Text="Pending Approvals" Path="/approvals" Icon="pending_actions" />
                </RadzenPanelMenuItem>
            </AuthorizeView>

            <AuthorizeView Roles="Admin">
                <RadzenPanelMenuItem Text="Administration" Icon="settings">
                    <RadzenPanelMenuItem Text="Users" Path="/admin/users" Icon="people" />
                    <RadzenPanelMenuItem Text="Departments" Path="/admin/departments" Icon="business" />
                </RadzenPanelMenuItem>
            </AuthorizeView>

            <RadzenPanelMenuItem Text="Sample Pages" Icon="widgets">
                <RadzenPanelMenuItem Text="Counter" Path="/counter" Icon="calculate" />
                <RadzenPanelMenuItem Text="Weather" Path="/weather" Icon="wb_cloudy" />
                <RadzenPanelMenuItem Text="Auth Test" Path="/auth" Icon="verified_user" />
            </RadzenPanelMenuItem>
        </RadzenPanelMenu>
    </RadzenSidebar>

    <RadzenBody>
        <div class="rz-p-4">
            @Body
        </div>
    </RadzenBody>
</RadzenLayout>

@code {
    private bool sidebarExpanded = true;

    private string GetReturnUrl() => Navigation.ToBaseRelativePath(Navigation.Uri);
}
