@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Identity
@using ProcureHub.Models

@inject SignInManager<User> SignInManager
@inject IdentityRedirectManager RedirectManager

@if (_externalLogins.Length == 0)
{
    <RadzenText TextStyle="TextStyle.Body2" Style="text-align: center; color: var(--rz-text-secondary-color);">
        No external authentication providers configured.
    </RadzenText>
}
else
{
    <RadzenStack Gap="0.5rem">
        @foreach (var provider in _externalLogins)
        {
            <form action="Account/PerformExternalLogin" method="post">
                <AntiforgeryToken />
                <input type="hidden" name="ReturnUrl" value="@ReturnUrl" />
                <input type="hidden" name="provider" value="@provider.Name" />
                <RadzenButton
                    ButtonType="ButtonType.Submit"
                    Variant="Variant.Filled"
                    ButtonStyle="ButtonStyle.Light"
                    Style="width: 100%;"
                    Size="ButtonSize.Large"
                    Text="@GetButtonText(provider)" />
            </form>
        }
    </RadzenStack>
}

@code {
    private AuthenticationScheme[] _externalLogins = [];

    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    protected override async Task OnInitializedAsync()
    {
        _externalLogins = (await SignInManager.GetExternalAuthenticationSchemesAsync()).ToArray();
    }

    private static string GetButtonText(AuthenticationScheme provider)
    {
        return provider.Name switch
        {
            "Microsoft" => "Sign in with Microsoft",
            "Google" => "Sign in with Google",
            "GitHub" => "Sign in with GitHub",
            _ => $"Sign in with {provider.DisplayName}"
        };
    }
}
