Use these rules when adding or generating new functionality.

## Canonical Directory Structure

```
src/
├─ routes/                # Navigation + route composition only
│  ├─ __root.tsx          # App root (sets auth context with router)
│  ├─ index.tsx           # Landing page
│  ├─ login.tsx
│  ├─ register.tsx
│  │
│  └─ (auth)/             # Authenticated app area
│     └─ _app-layout/
│        ├─ route.tsx     # Auth guard layout (redirect if not logged in)
│        └─ dashboard.tsx # Dashboard / app home
│
├─ features/              # Business capabilities (domain logic)
│  ├─ auth/
│  │  ├─ hooks.ts         # useAuth, useCurrentUser
│  │  ├─ provider.tsx
│  │  └─ types.ts
│  │
│  └─ posts/              # Example feature
│     ├─ api.ts
│     └─ types.ts
│
├─ components/            # Reusable UI components
│  └─ ui/                 # shadcn/ui components
│     ├─ avatar.tsx
│     ├─ badge.tsx
│     ├─ button.tsx
│     ├─ card.tsx
│     └─ ...              # Other UI primitives
│
├─ lib/                   # Cross-cutting infrastructure
│  ├─ api/
│  │  ├─ client.ts        # API client
│  │  ├─ schema.d.ts      # Generated API schema types
│  │  └─ types.ts
│  └─ utils.ts
│
├─ hooks/                 # Shared custom hooks
│  └─ use-mobile.ts
│
├─ providers.tsx          # App-level providers
├─ routeTree.gen.ts       # Generated by TanStack Router
├─ styles.css
└─ main.tsx
```

## Core Rules

1. **Routes are for navigation only** — no business logic, no API calls.

2. **Every business capability lives in `features/`** (auth, posts, etc.).

3. **Deleting a feature folder should remove a real app capability.**

4. **Unauthenticated pages (login, register) are at route root; authenticated pages go in `(auth)`.**

5. **Auth is enforced once** in `(auth)/_app-layout/route.tsx` using `beforeLoad`.

6. **Routes call feature hooks/APIs; features never import routes.**

7. **Use nested layouts** for app chrome (sidebar, navbar), not per-page wrappers.

8. **UI primitives go in `components/ui/`** (shadcn/ui components, no domain or routing knowledge).

9. **Cross-cutting helpers go in `lib/`** (API client, utils).

10. **Group by domain, not by file type.**

---

## Mental Model

- Routes decide **when** something runs
- Features decide **how** it works

Never mix the two.
